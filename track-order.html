<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Track My Order â€” PupSmile</title>
  <link rel="stylesheet" href="styles.css?v=6" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,400;0,500;0,600;0,700;0,800;1,400;1,700&family=Inter:wght@400;500&display=fallback" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,400;0,500;0,600;0,700;0,800;1,400;1,700&family=Inter:wght@400;500&display=fallback" media="print" onload="this.media='all'" />
  <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,400;0,500;0,600;0,700;0,800;1,400;1,700&family=Inter:wght@400;500&display=fallback" /></noscript>
</head>
<body>

  <!-- NAV -->
  <nav class="nav">
    <div class="container nav__inner">
      <a href="index.html" class="nav__logo">
        <img src="images/logo.png" alt="PupSmile" class="nav__logo-img" />
      </a>
      <ul class="nav__links">
        <li><a href="index.html#problem">The truth</a></li>
        <li><a href="index.html#how-it-works">How it works</a></li>
        <li><a href="index.html#founder">Our story</a></li>
        <li><a href="index.html#reviews">Reviews</a></li>
        <li><a href="https://shopify.com/96117031239/account" class="nav__account-link" target="_blank">My Account</a></li>
      </ul>
      <a href="index.html#buy" class="btn btn--cta btn--sm">Get PupSmile â†’</a>
    </div>
  </nav>

  <!-- HERO -->
  <div class="track-hero">
    <div class="container">
      <h1>Track My Order</h1>
      <p>Enter your tracking number to see exactly where your package is right now.</p>
    </div>
  </div>

  <!-- BODY -->
  <div class="track-body">
    <div class="container">

      <!-- FORM CARD -->
      <div class="track-form-card">
        <h2>Where is my package?</h2>
        <p>Your tracking number is in the shipping confirmation email. It can take 48â€“72 hours to activate after shipment.</p>
        <div class="track-input-row">
          <input type="text" id="trackingInput" placeholder="e.g. RR123456789CN" autocomplete="off" />
          <button class="btn btn--primary" id="trackBtn" onclick="trackOrder()">Track â†’</button>
        </div>
        <p class="track-note">Can't find it? <a href="contact.html" style="color:var(--green);">Contact us</a> and we'll look it up.</p>
      </div>

      <!-- LOADING -->
      <div class="track-loading" id="trackLoading">
        <span class="track-spinner"></span>
        Looking up your shipmentâ€¦
      </div>

      <!-- INFO (syncing / not-found messages) -->
      <div class="track-info" id="trackInfo"></div>

      <!-- ERROR -->
      <div class="track-error" id="trackError"></div>

      <!-- RESULT CARD -->
      <div class="track-result-card" id="trackResult">

        <!-- Progress bar -->
        <div class="tp-bar">
          <div class="tp-step" data-stage="0">
            <div class="tp-dot"></div>
            <span class="tp-label">Preparing</span>
          </div>
          <div class="tp-line"></div>
          <div class="tp-step" data-stage="1">
            <div class="tp-dot"></div>
            <span class="tp-label">Shipped</span>
          </div>
          <div class="tp-line"></div>
          <div class="tp-step" data-stage="2">
            <div class="tp-dot"></div>
            <span class="tp-label">In Transit</span>
          </div>
          <div class="tp-line"></div>
          <div class="tp-step" data-stage="3">
            <div class="tp-dot"></div>
            <span class="tp-label">Out for Delivery</span>
          </div>
          <div class="tp-line"></div>
          <div class="tp-step" data-stage="4">
            <div class="tp-dot"></div>
            <span class="tp-label">Delivered</span>
          </div>
        </div>

        <!-- Status row -->
        <div class="track-status-row">
          <span class="track-badge" id="trackBadge"></span>
          <span class="track-transit-days" id="trackTransitDays"></span>
        </div>

        <!-- ETA / destination -->
        <div class="track-eta" id="trackEta" style="display:none">
          <span class="track-eta-icon">ðŸ“…</span>
          <div class="track-eta-text">
            <div class="track-eta-label">Estimated delivery</div>
            <div class="track-eta-value" id="trackEtaValue"></div>
            <div class="track-dest-line" id="trackDestLine"></div>
          </div>
        </div>

        <!-- Event timeline -->
        <div class="track-timeline-heading">Shipment updates</div>
        <ul class="track-timeline" id="trackTimeline"></ul>

      </div>

    </div>
  </div>

  <!-- FOOTER -->
  <footer class="footer">
    <div class="container footer-inner">
      <div class="footer-brand">
        <img src="images/logo.png" alt="PupSmile" class="footer-logo" />
        <p>Natural dental care for happy, healthy dogs.</p>
      </div>
      <div class="footer-links">
        <ul>
          <li><a href="index.html#faq">FAQ</a></li>
          <li><a href="track-order.html">Track My Order</a></li>
          <li><a href="contact.html">Contact Us</a></li>
          <li><a href="medical-disclaimer.html">Medical Disclaimer</a></li>
          <li><a href="terms-of-service.html">Terms of Service</a></li>
          <li><a href="privacy-policy.html">Privacy Policy</a></li>
          <li><a href="refund-policy.html">Refund Policy</a></li>
          <li><a href="shipping-policy.html">Shipping Policy</a></li>
          <li><a href="https://shopify.com/96117031239/account" target="_blank">Manage Subscription</a></li>
        </ul>
      </div>
    </div>
    <div class="container footer-bottom">
      <p>Â© 2026 PupSmile. All rights reserved. Â· These statements have not been evaluated by the FDA. This product is not intended to diagnose, treat, cure, or prevent any disease.</p>
    </div>
  </footer>

  <script>
    const COLOR_CLASS = {
      blue:   'track-badge--blue',
      green:  'track-badge--green',
      yellow: 'track-badge--yellow',
      red:    'track-badge--red',
      gray:   'track-badge--gray',
    };

    function formatETA(dateStr) {
      if (!dateStr) return null;
      const parts = dateStr.split(' ')[0].split('-');
      const est = new Date(+parts[0], +parts[1] - 1, +parts[2]);
      const now = new Date(); now.setHours(0,0,0,0);
      const diff = Math.round((est - now) / 86400000);
      if (diff < 0)  return 'Expected very soon';
      if (diff === 0) return 'Expected today';
      if (diff === 1) return 'Expected tomorrow';
      if (diff <= 6)  return `Expected in ${diff} days`;
      return `Expected by ${est.toLocaleDateString('en-US', { month: 'long', day: 'numeric' })}`;
    }

    function formatDate(d) {
      if (!d) return '';
      const dt = new Date(d);
      if (isNaN(dt)) return d;
      return dt.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }) +
             ' Â· ' + dt.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
    }

    function renderProgress(stage) {
      document.querySelectorAll('.tp-step').forEach(s => {
        const n = +s.dataset.stage;
        s.classList.toggle('done', n < stage);
        s.classList.toggle('now',  n === stage);
      });
      document.querySelectorAll('.tp-line').forEach((l, i) => {
        l.classList.toggle('done', i < stage);
      });
    }

    function setLoading(on) {
      document.getElementById('trackLoading').classList.toggle('visible', on);
      document.getElementById('trackBtn').disabled = on;
    }

    function clearState() {
      document.getElementById('trackError').classList.remove('visible');
      document.getElementById('trackInfo').classList.remove('visible');
      document.getElementById('trackResult').classList.remove('visible');
    }

    function showError(msg) {
      const el = document.getElementById('trackError');
      el.textContent = msg;
      el.classList.add('visible');
    }

    function showInfo(msg) {
      const el = document.getElementById('trackInfo');
      el.textContent = msg;
      el.classList.add('visible');
    }

    async function trackOrder() {
      const num = document.getElementById('trackingInput').value.trim();
      if (!num) { clearState(); showError('Please enter a tracking number.'); return; }

      clearState();
      setLoading(true);

      try {
        const res  = await fetch(`/.netlify/functions/track?number=${encodeURIComponent(num)}`);
        const data = await res.json();
        setLoading(false);

        if (data.error) { showError(data.error); return; }

        if (data.message) {
          if (data.status === 'syncing') showInfo(data.message);
          else showError(data.message);
          return;
        }

        // --- Progress bar ---
        renderProgress(data.progressStage ?? 1);

        // --- Status badge ---
        const badge = document.getElementById('trackBadge');
        badge.textContent = data.statusLabel || 'In Transit';
        badge.className = 'track-badge ' + (COLOR_CLASS[data.statusColor] || COLOR_CLASS.blue);

        // --- Transit days ---
        const td = document.getElementById('trackTransitDays');
        td.textContent = data.transitDays ? `${data.transitDays} days in transit` : '';

        // --- ETA / destination ---
        const etaBox  = document.getElementById('trackEta');
        const etaVal  = document.getElementById('trackEtaValue');
        const destLn  = document.getElementById('trackDestLine');
        const etaTxt  = formatETA(data.estimatedDelivery);
        if (etaTxt || data.destinationCity) {
          etaVal.textContent  = etaTxt || '';
          destLn.textContent  = data.destinationCity ? `Heading to ${data.destinationCity}` : '';
          etaBox.style.display = 'flex';
        } else {
          etaBox.style.display = 'none';
        }

        // --- Timeline ---
        const timeline = document.getElementById('trackTimeline');
        timeline.innerHTML = '';
        const events = data.events || [];

        if (!events.length) {
          timeline.innerHTML = '<li><div class="track-en-route">Your package has left our fulfillment center and is on its way. Detailed tracking updates will appear once it arrives in your country â€” usually within a few days.</div></li>';
        } else {
          events.forEach((ev) => {
            const li = document.createElement('li');
            li.className = 'track-event';
            const locPart  = ev.location ? `<span class="tev-location">${ev.location}</span>` : '';
            const datePart = ev.date     ? `<span class="tev-date">${formatDate(ev.date)}</span>` : '';
            const meta     = [locPart, datePart].filter(Boolean).join('<span class="tev-sep">Â·</span>');
            li.innerHTML = `
              <div class="track-event-dot-col">
                <div class="track-event-dot"></div>
                <div class="track-event-line"></div>
              </div>
              <div class="tev-body">
                <div class="track-event-desc">${ev.description || 'Update'}</div>
                ${meta ? `<div class="track-event-meta">${meta}</div>` : ''}
              </div>`;
            timeline.appendChild(li);
          });
        }

        document.getElementById('trackResult').classList.add('visible');
        document.getElementById('trackResult').scrollIntoView({ behavior: 'smooth', block: 'nearest' });

      } catch (err) {
        setLoading(false);
        showError('Something went wrong. Please check your connection and try again.');
      }
    }

    document.getElementById('trackingInput').addEventListener('keydown', (e) => {
      if (e.key === 'Enter') trackOrder();
    });
  </script>

</body>
</html>
